{% extends "base.html" %}

{% block content %}
{% load static %}

{% if form %}
<form action="{% url 'filter' %}" method="post" style="padding-top:2em">
    {% csrf_token %}
        {{ form.as_ul }}
    <button class="btn btn-primary" type="submit">search</button>
</form>
{% endif %}



<script type="text/javascript" src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
{{ form.media }}

<script>
    (function ($) {
        $('#add-form').click(function () {
            var index = $('#id_inline_test_models-TOTAL_FORMS').val()
            var newTable = $('#id_inline_test_models-__prefix__-DELETE').parents('table').clone()
            newTable.find(':input').each(function () {
                for (attr of ['name', 'id'])
                    $(this).attr(
                        attr,
                        $(this).attr(attr).replace('__prefix__', index)
                    )
            })
            newTable.insertBefore($(this))
            $('#id_inline_test_models-TOTAL_FORMS').val(
                parseInt($('#id_inline_test_models-TOTAL_FORMS').val()) + 1
            )
            newTable.slideDown()
        })
    })($)
</script>

<h1 class="center">Books</h1>

<div class="container-fluid">
    <table id="books" class="table table-hover table-responsive table-bordered">
        <thead class="thead-dark">
            <tr>
                <!--When a header is clicked, run the sortTable function, with a parameter, 0 for sorting by names, 1 for sorting by country:-->
                <th scope="col" class="title" onclick="sortTable(0)">Title</th>
                <th scope="col" class="author" onclick="sortTable(1)">Author</th>
                <th scope="col" class="rating" onclick="sortTable(2)">Rating</th>
                <th scope="col" class="tags" onclick="sortTable(3)">Tags</th>
                <th scope="col" class="added" onclick="sortTable(4)">Added</th>
                <th scope="col" class="published" onclick="sortTable(5)">Published</th>
            </tr>
        </thead>
    
        <tbody>
            {% for book in book_list %}
            <tr>
                <td><a href="{{ book.get_absolute_url }}">{{ book.title }}</a></td>
                <td class="authors">
                    {% for author in book.authors.all %}
                    <a href="{{ author.get_absolute_url }}" rel="author">{{ author }}</a>
                    {% endfor %}
    
                </td>
                <td>
                    {% for rating in book.ratings.all %}
                    <a href="{{ rating.get_absolute_url }}" rel="rating">{{ rating }}</a>
                    {% endfor %}
                </td>
                <td class="tags">
                    <!-- stefan  -->
                    {% for tag in book.tags.all %}
                    <a href="{{ tag.get_absolute_url }}" rel="tag">{{ tag }}</a>
                    {% endfor %}
                </td>
                <td>{{ book.timestamp | date:"d/m/Y" }}</td>
                <td>{{ book.pubdate.year }}</td>
            </tr>
            {% endfor %}
        </tbody>
    
    
    </table>
  </div>



{% endblock %}