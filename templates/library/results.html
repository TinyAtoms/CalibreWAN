{% extends "base.html" %}

{% block content %}
    {% load static %}

    {% if form %}
        <div class="container">
            <form action="{% url 'filter' %}" method="post" style="padding-top:2em">
                {% csrf_token %}
                {{ form.as_p }}
                <button class="waves-effect waves-light btn blue accent-4" type="submit">search</button>
            </form>

        </div>
        {#        {% load crispy_forms_tags %}#}
        {#        {% crispy form form.helper %}#}
    {% endif %}

    <script type="text/javascript" src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
    {{ form.media }}

    <script>
        (function ($) {
            $('#add-form').click(function () {
                var index = $('#id_inline_test_models-TOTAL_FORMS').val()
                var newTable = $('#id_inline_test_models-__prefix__-DELETE').parents('table').clone()
                newTable.find(':input').each(function () {
                    for (attr of ['name', 'id'])
                        $(this).attr(
                            attr,
                            $(this).attr(attr).replace('__prefix__', index)
                        )
                })
                newTable.insertBefore($(this))
                $('#id_inline_test_models-TOTAL_FORMS').val(
                    parseInt($('#id_inline_test_models-TOTAL_FORMS').val()) + 1
                )
                newTable.slideDown()
            })
        })($)
    </script>

    <h1 class="center">Books</h1>

    <div class="row">
        <div class="col s1 m0">
        </div>
        <div class="col s10 m12">
            <table id="books" class="highlight centered">
                <tr>
                    <!--When a header is clicked, run the sortTable function, with a parameter, 0 for sorting by names, 1 for sorting by country:-->
                    <th class="title" onclick="sortTable(0)">Title</th>
                    <th class="author" onclick="sortTable(1)">Author</th>
                    <th class="rating" onclick="sortTable(2)">Rating</th>
                    <th class="tags" onclick="sortTable(3)">Tags</th>
                    <th class="added" onclick="sortTable(4)">Added</th>
                    <th class="published" onclick="sortTable(5)">Published</th>
                </tr>
                {% for book in book_list %}
                    <tr>
                        <td><a href="{{ book.get_absolute_url }}">{{ book.title }}</a></td>
                        <td>
                            {% for author in book.authors.all %}
                                <a href="{{ author.get_absolute_url }}" rel="author">{{ author }}</a>
                            {% endfor %}

                        </td>
                        <td>
                            {% for rating in book.ratings.all %}
                                {{ rating }}
                            {% endfor %}
                        </td>
                        <td class="tags">
                            <!-- stefan  -->
                            {% for tag in book.tags.all %}
                                <a href="{{ tag.get_absolute_url }}" rel="tag">{{ tag }}</a>
                            {% endfor %}
                        </td>
                        <td>{{ book.timestamp | date:"d/m/Y" }}</td>
                        <td>{{ book.pubdate.year }}</td>
                    </tr>
                {% endfor %}
            </table>
            <div class="col s1 m0">
            </div>
        </div>
    </div>
{% endblock %}